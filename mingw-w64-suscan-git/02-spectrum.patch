diff --git a/cli/cmd/spectrum.c b/cli/cmd/spectrum.c
index 13ab3e9..ab1a3ee 100644
--- a/cli/cmd/spectrum.c
+++ b/cli/cmd/spectrum.c
@@ -30,6 +30,9 @@
 #include <signal.h>
 #include <time.h>
 #include <sys/stat.h>
+#if defined(_WIN32)
+#include <direct.h>
+#endif
 
 #include <cli/cli.h>
 #include <cli/cmds.h>
@@ -431,12 +434,18 @@ SU_METHOD(suscli_spectrum, SUBOOL, open_dataset)
       SU_ERROR("Cannot create output directory %s: file exists\n", self->odir);
       goto done;
     }
-  } else if (mkdir(self->odir, 0755) == -1) {
-    SU_ERROR(
-      "Cannot create output directory %s: %s\n",
-      self->odir,
-      strerror(errno));
-    goto done;
+  } else {
+#if defined(_WIN32)
+    if (_mkdir(self->odir) == -1) {
+#else
+    if (mkdir(self->odir, 0755) == -1) {
+#endif
+      SU_ERROR(
+        "Cannot create output directory %s: %s\n",
+        self->odir,
+        strerror(errno));
+      goto done;
+    }
   }
 
   SU_TRY(ts_path    = strbuild("%s/ts.npy",    self->odir));
@@ -487,6 +496,7 @@ SU_INSTANCER(
   suscli_spectrum_t *new = NULL;
   struct timeval tv;
   struct tm tm;
+  time_t now;
 
   SU_ALLOCATE_FAIL(new, suscli_spectrum_t);
 
@@ -498,7 +508,12 @@ SU_INSTANCER(
 
   if (params->prefix == NULL) {
     gettimeofday(&tv, NULL);
-    gmtime_r(&tv.tv_sec, &tm);
+    now = tv.tv_sec;
+#if defined(_WIN32)
+    gmtime_s(&tm, &now);
+#else
+    gmtime_r(&now, &tm);
+#endif
 
     SU_TRY_FAIL(new->prefix =
       strbuild(
@@ -901,4 +916,3 @@ done:
 
   return ok;
 }
-
